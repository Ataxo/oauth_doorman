## OAuth Doorman

### Description

oauth_doorman is a gem which handles Google OAuth authorization in your application: 
* composes authentification url
* retrieves access_token for user account 
* provides methods for access to Google API

### Account administration

* create developer account representing your company if doesn't exist
* this account must have rights to manipulate with user informations, so, let Administrator to enable the Provisioning API
* register your new Application at https://code.google.com/apis/console/ in API Access tab

### Hash Parameters

Required keys:
* redirect_uri - your callback url
* client_id - generated by google when registering application
* client_secret - generated by google when registering application

Defaults:
<table>
<tr><td>scopes</td><td>`"https://www.googleapis.com/auth/userinfo.email", "https://apps-apis.google.com/a/feeds/groups/"]`</td></tr>
<tr><td>auth_url</td><td>`"https://accounts.google.com/o/oauth2/auth"`</td></tr>
<tr><td>token_url</td><td>`"https://accounts.google.com/o/oauth2/token"`</td></tr>
<tr><td>response_type</td><td>`"code"`</td></tr>
<tr><td>state</td><td>`"ATAXO"`</td></tr>
<tr><td>user_info_url</td><td>`"https://www.googleapis.com/oauth2/v1/userinfo"`</td></tr>
<tr><td>groups_info_url</td><td>`"https://apps-apis.google.com/a/feeds/group/2.0/%s/?member=%s"`</td></tr>
<tr><td>groups_info_auth_header_name</td><td>`"Authorization"`</td></tr>
<tr><td>groups_info_auth_header_content</td><td>`"OAuth %s"`</td></tr>
<tr><td>groups_info_request_timeout</td><td>`5`</td></tr>
</table>

[Available scopes](./oauth_doorman/tree/master/README_scopes.md)

### Examples

* Initialize Oauth Doorman

```ruby
api = OauthDoorman::Api.new(
  :redirect_uri => "http://localhost:3000/oauth2callback", 
  :client_id => "123456789.apps.googleusercontent.com", 
  :client_secret => "O1ciRD-F1EX9h8t8LSQlFQk7", 
  :state => "MYSTATE"
)
```

* Redirect to Google Account gate

```ruby
url = api.compose_authentification_request_url(false)
```
`force_refresh_token` determines whether `refresh_token` should be returned in your callback method (if true, user is always asked for permission to provide refresh_token).

* Initialize OAuth Doorman instance by code or refresh_token in callback method (it's the only way to access API methods in the future)

```ruby
api.init_connection_by_code(request.params[:code])
# in case when you know the refresh_token
provisioning_api.init_connection_by_refresh_token("feififjsd756osd-sdfewd435ssd") 
```

* Calling API functions

```ruby
current_user = api.get_user_email()
hash_result = provisioning_api.get_user_groups("ataxo.com", current_user)
```

### Author

2012 Ataxo Interactive, a.s.